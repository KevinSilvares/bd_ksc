# PR0202: Uso del cliente HDFS

### Preparación del entorno
- Crea un directorio personal en HDFS bajo /user con tu nombre de usuario y dentro de él un directorio llamado proyecto_datos.
  
    `hdfs dfs -mkdir -p /user/kevins/proyecto_datos`

### Carga de datasets
- Descarga el dataset Automotive Price Prediction Dataset que puedes obtener desde Kaggle y que contiene un dataset sintético con información y precio de 1000000 de vehículos de segunda mano.
- Desde tu sistema local, sube al directorio proyecto_datos el dataset que has descargado.

Primero he descargado el fichero zip desde kaggle con `curl -L -o ~/vehicle-price-prediction.zip\
  https://www.kaggle.com/api/v1/datasets/download/metawave/vehicle-price-prediction`.

Después lo he descomprimido en local con `unzip vehicle-price-prediction.zip`.

Por último lo he movido al sistema distribuido con `hdfs dfs -put vehicle_price_prediction.csv /user/kevins/proyecto_datos`.

### Exploración de datos
- Visualiza el contenido del archivo directamente en HDFS.
- Obtén el número de líneas del dataset.

`hdfs dfs -head /user/kevins/proyecto_datos/vehicle_price_prediction.csv`

![Salida head]({F9713195-2187-4298-9868-43C904A788E3}.png)

### Organización del proyecto
- Crea un subdirectorio procesados y otro backup dentro de tu carpeta de proyecto.
- Copia el archivo original a backup.
- Mueve el archivo original de proyecto_datos a procesados.

`hdfs dfs -mkdir /user/kevins/proyecto_datos/procesados`
![alt text]({07CEB3E3-B2ED-4B72-803B-F4DFF4E0E81E}.png)

`hdfs dfs -cp /user/kevins/proyecto_datos/vehicle_price_prediction.csv /user/kevins/proyecto_datos/backup`
![alt text]({ECC58DCB-2C53-4EBB-9795-DF6C9E2DAC05}.png)

`hdfs dfs -mv /user/kevins/proyecto_datos/vehicle_price_prediction.csv
/user/kevins/proyecto_datos/procesados`
![alt text]({76121858-3C15-4564-92AC-FB946AABD977}.png)

### Colaboración en el equipo
- Crea un directorio compartido bajo /compartido (si no existe) y copia allí tu dataset para que otros puedan acceder.

`hdfs dfs -mkdir /user/kevins/proyecto_datos/compartido`
![]({2E853D2A-227E-45AD-A4C4-B6BB2EC7DC45}.png)

`dfs dfs -cp /user/kevins/proyecto_datos/procesados/vehicle_price_prediction.csv /user/kevins/proyecto_datos/compartido`
![alt text]({85FEECB1-22D6-405D-8DD8-DA79CCBC8929}.png)

![alt text]({2806DBBC-289A-4181-861A-BF30EBF1C87F}.png)

### Recuperación de datos
- Descarga a tu sistema local el archivo que está en el directorio procesados.

`hdfs dfs -get /user/kevins/proyecto_datos/procesados/vehicle_price_prediction.csv /tmp`
![alt text]({EA9C2BB2-B58F-4832-B86A-B063D129A139}.png)

### Control de accesos
- Verifica los permisos de tus archivos.
- Cambia los permisos de un archivo de backup para que solo tú tengas acceso de lectura y escritura.

`hdfs dfs -ls /user/kevins/proyecto_datos`
![]({FF6FD0A6-9A0F-4B8A-AE0A-BDDD47AB1EC3}.png)

`hdfs dfs -chmod 600 /user/kevins/proyecto_datos/backup`
![alt text]({88C081C8-D4F9-46DB-9FCF-A0D14B93EAD1}.png)

### Mantenimiento
- Elimina un archivo temporal que hayas subido por error a tu espacio en HDFS.

![alt text]({F7EAFA8F-A169-4F06-BF23-DE1E99ECB764}.png)

`hdfs dfs -rm /user/kevins/proyecto_datos/temp`
![alt text]({9BB0B142-EF76-4A18-AAEF-82AFA0551BF0}.png)

### (Opcional, avanzado)
- Configura una cuota de número de archivos en tu directorio de proyecto y prueba a superar el límite para observar el comportamiento de HDFS.

`hdfs dfsadmin -setQuota 3 /user/kevins/proyecto_datos`

![alt text]({0F5A9679-7D47-42D0-BAD4-388B80C97FB9}.png)

Aparece un mensaje de error y no permite añadir nada más.

Para eliminar la cuota:

`hdfs dfsadmin -clrQuota /user/kevins/proyecto_datos`

[Volver](../index.md)